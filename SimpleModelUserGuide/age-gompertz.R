library(flexsurv) # For pgompertz

gompertz.parameters <- structure(list(Age = 0:109, male.shape = c(0.0839099666144178, 
0.0863545368420834, 0.0864959542777852, 0.0865857093659457, 0.0866427580167716, 
0.0866710567568498, 0.086685305874295, 0.0866890694765237, 0.0866928407229153, 
0.086689352522366, 0.0866818285363415, 0.0866665897629292, 0.0866568650433342, 
0.0866421360537361, 0.086635206503713, 0.0866419538453429, 0.0866680641029371, 
0.0867413882459114, 0.0868576111015786, 0.0870565465575548, 0.0872717323685741, 
0.087502528404248, 0.0877698403703, 0.0880240308394903, 0.0882734236565252, 
0.0885356466970456, 0.0887706903935491, 0.0890016470469193, 0.0892125022089132, 
0.0894200143228775, 0.0896171764177102, 0.0898027392077403, 0.0899811037902553, 
0.0901393012993638, 0.0902899157875037, 0.0904085038166389, 0.0905239521161046, 
0.0906229295636137, 0.0907251941233554, 0.0908254673271498, 0.0909236777059884, 
0.0909978683945304, 0.0910796747106975, 0.0911818458902425, 0.0912686985410354, 
0.0913947921753429, 0.0915403860444918, 0.0917155323553057, 0.0919101680898209, 
0.0921173918491303, 0.0923643339925672, 0.0926228701947507, 0.092878777186118, 
0.0931905776359454, 0.0935325430002048, 0.093855028478984, 0.0942290551585982, 
0.0946161045995216, 0.0950363482539612, 0.0954655421027429, 0.0958734958569555, 
0.0962495548153683, 0.0965415869569771, 0.0968581942992871, 0.0972765074285911, 
0.0974522267207879, 0.0976676683821628, 0.0979020460971217, 0.0981995637072966, 
0.0983261489249738, 0.0984446481456063, 0.0985022386313393, 0.0983888416539038, 
0.0983271169258337, 0.0980118655740999, 0.0977040949474637, 0.0974410040815817, 
0.0967824352037111, 0.096096591261705, 0.0952149718860845, 0.0938918862802438, 
0.0924081263304597, 0.0905054417334444, 0.0886871015430329, 0.085881377582761, 
0.0828875957721479, 0.0790820293506478, 0.0732043454064439, 0.0665991461030117, 
0.0594662943944009, 0.0493618051837447, 0.0419977324447883, 0.0286138562818902, 
0.0174655142511813, 0.00602251396608045, -0.0018823026291847, 
-0.0168854852258125, -0.0338280270363796, -0.0525902511748149, 
-0.0733505283670404, -0.096588987376127, -0.121461274991337, 
-0.150341918073539, -0.181693326939393, -0.211382989396721, -0.235698359286758, 
-0.280893995983081, -0.285868779607888, -0.306538426594787, -0.867992431635279
), male.rate = c(7.87453170616663e-05, 7.07952581481269e-05, 
7.63436061508606e-05, 8.26740641387185e-05, 8.97656420871415e-05, 
9.76846679408751e-05, 0.000106417726549994, 0.000116022724341424, 
0.000126495518700382, 0.000137985155557839, 0.000150559625438508, 
0.000164364421699775, 0.000179362840236854, 0.000195791406054745, 
0.000213609246114981, 0.000232839415952679, 0.000253491160977897, 
0.000275171698753055, 0.000297957263488503, 0.000321079536831434, 
0.000345790732523016, 0.000372213609438541, 0.000399981244570996, 
0.000430362905995774, 0.000463402686260207, 0.000498859989903742, 
0.000538096399995518, 0.000580806600815546, 0.000627848565095007, 
0.000679091383245009, 0.000735194739270676, 0.0007966948793082, 
0.000863950750743079, 0.000938115588150491, 0.00101932052375906, 
0.00110952205252569, 0.00120815304920089, 0.00131681052216136, 
0.00143530594093712, 0.00156490413346364, 0.00170667881684749, 
0.00186348639282403, 0.00203436914345002, 0.0022194936016548, 
0.0024233637018604, 0.00264250459106762, 0.00288009220091562, 
0.00313658613242535, 0.00341472386724675, 0.00371729106184341, 
0.00404289647292547, 0.00439741247266182, 0.00478570058063291, 
0.00520180930464519, 0.00565226057239808, 0.00614909744069915, 
0.00668383607501002, 0.007267481539448, 0.00790070809326387, 
0.00859374204104569, 0.00935993990523223, 0.0102100613297509, 
0.0111673141753348, 0.012214213561424, 0.0133387193446991, 0.0146507772856619, 
0.0160856540946885, 0.0176626985578478, 0.0193802892312114, 0.0213445323700644, 
0.0235187008496499, 0.0259493776624735, 0.0287175991319613, 0.0317547507195705, 
0.0352477986171452, 0.0391110678324361, 0.043358720738377, 0.048306809992353, 
0.0538061574259207, 0.0600140600695418, 0.0672251669252463, 0.0752746580929447, 
0.0845736298966418, 0.0947249127659961, 0.106819546951475, 0.12029602225958, 
0.135925085455915, 0.155289024529497, 0.177182995899766, 0.201533637576733, 
0.231610744402751, 0.259959209022377, 0.298903835183746, 0.336484345217616, 
0.376499931772298, 0.41300029705918, 0.463950805981316, 0.520700050794781, 
0.583198426967992, 0.651958108526282, 0.728101130271571, 0.810188635937347, 
0.903417552186997, 1.00469455991698, 1.10634701185732, 1.20513065397687, 
1.36502883244543, 1.48155955061126, 1.76534479730726, 3.49067025881219
), female.shape = c(0.094797389946942, 0.0974952417325532, 0.0976865683828879, 
0.0977822753764843, 0.0978517920407206, 0.0979001897530605, 0.097932487334074, 
0.0979676124428366, 0.09799608363508, 0.0980224492680452, 0.0980420433606647, 
0.0980637547907143, 0.0980873195408817, 0.0981124606461379, 0.0981346892117908, 
0.0981663262490013, 0.0982027923964281, 0.0982644882017819, 0.0983341066900768, 
0.098423343316499, 0.098527424614681, 0.098629731957963, 0.0987416558178053, 
0.098850843050508, 0.0989567950338615, 0.099074232415236, 0.0991834765551853, 
0.0992914252343816, 0.0993899622696156, 0.0995039636412175, 0.0996178778859456, 
0.0997340534220318, 0.0998379198543529, 0.099952573998344, 0.100052455606082, 
0.100156904051816, 0.100267782488025, 0.100386867504054, 0.100502341651944, 
0.10062837895928, 0.100751061677255, 0.100870395713146, 0.101003453542002, 
0.101144433982617, 0.101306136963735, 0.101488937354585, 0.101674054336805, 
0.101916523439325, 0.102158058486448, 0.102406831593824, 0.102676809237433, 
0.102969721836788, 0.103253820247157, 0.103586591958555, 0.103879206328202, 
0.104189990918756, 0.104452251097483, 0.104737519818479, 0.104992393615004, 
0.105263467106987, 0.105489560451092, 0.105696050782815, 0.105902460037338, 
0.106106990128671, 0.106440081327094, 0.106547976378229, 0.106754305085702, 
0.106965196980413, 0.107228933720145, 0.107351354913231, 0.107455160575311, 
0.107535956641014, 0.107564707777834, 0.107569400819157, 0.107388876240732, 
0.107155187689601, 0.106985480107662, 0.106485687717131, 0.106019842332764, 
0.105390689079756, 0.104384572960218, 0.10316741087293, 0.101436049502593, 
0.0997590387537148, 0.0973638379053296, 0.0948500191964938, 0.0919117092526837, 
0.0878299719353226, 0.0825874019553725, 0.0767479284718086, 0.0698692458644153, 
0.0642722083526853, 0.0553427892390398, 0.0468436582901482, 0.0371872587604018, 
0.0277434952641528, 0.0152708742509208, 0.00114734273040658, 
-0.0148659694093396, -0.032835672826894, -0.0530431980584192, 
-0.075623263707104, -0.100476751737994, -0.127205860229748, -0.154843842061988, 
-0.181040055176468, -0.202640685897554, -0.199109990467118, -0.146267198986648, 
-3.60484750337861e-07), female.rate = c(2.44845411628666e-05, 
2.15757448504461e-05, 2.34184284688457e-05, 2.56237976544435e-05, 
2.81006150138579e-05, 3.08720978722515e-05, 3.39624410678822e-05, 
3.73564337883969e-05, 4.11130730246511e-05, 4.52571157242695e-05, 
4.98462493976305e-05, 5.48944049436316e-05, 6.04483636030321e-05, 
6.65599106362738e-05, 7.3307774200251e-05, 8.06911721071603e-05, 
8.87946631987597e-05, 9.75544384408723e-05, 0.000107135426071077, 
0.000117523715742945, 0.000128819437900968, 0.00014124524860839, 
0.000154808120208633, 0.000169738663443486, 0.000186184933652435, 
0.000204127922140554, 0.000223958036593978, 0.00024578493234097, 
0.000269938782169626, 0.000296268857808633, 0.000325240553176731, 
0.000357080804920151, 0.000392380683195189, 0.000431015951219399, 
0.000473916040215132, 0.000521068247023344, 0.000572847029045929, 
0.000629657479555156, 0.00069237865210095, 0.000761188610901817, 
0.000837071688855443, 0.000920926318427635, 0.00101280974257982, 
0.00111376965120115, 0.00122406696965888, 0.00134454831926282, 
0.00147726658909298, 0.00162003473172123, 0.00177747996850982, 
0.0019505936104343, 0.00213992610600652, 0.00234692339541179, 
0.00257614791658627, 0.00282463418606779, 0.00310311147056483, 
0.00340893506403422, 0.00375274821811415, 0.00413040699373268, 
0.00455256429610804, 0.00501795749803934, 0.00554066942444404, 
0.0061236935045979, 0.00677075566871991, 0.00748951373775665, 
0.00826179895741674, 0.00916818828307786, 0.0101534472513243, 
0.0112480305006489, 0.0124518214127213, 0.013831768430793, 0.0153742945094477, 
0.017100750316939, 0.0190434002409701, 0.0212187949934819, 0.0237190467881993, 
0.0265319011452194, 0.0296423360023772, 0.0332741095892454, 0.0373107421017707, 
0.0419057458039202, 0.047253249944068, 0.053353011209198, 0.0605030387766027, 
0.0684176951980221, 0.0777229229553759, 0.0882367291961979, 0.100217187670798, 
0.114518602137983, 0.13142249730882, 0.150580542202954, 0.172653888764331, 
0.195075160930899, 0.223612664132703, 0.253711330161415, 0.287624781520931, 
0.323586870187554, 0.366660381244055, 0.414997795943058, 0.469220795593332, 
0.529685016262521, 0.597149924356317, 0.672152782706872, 0.754886441007621, 
0.845188721907661, 0.942429593896074, 1.0450131223425, 1.15566597463677, 
1.2634115235312, 1.42625176287511, 1.9999915941136)), .Names = c("Age", 
"male_shape", "male_rate", "female_shape", "female_rate"), row.names = c(NA, 
110L), class = "data.frame")

# Note that the gender values flipped here (1 is now female)
ageAtDeath <- function(currentAge, gender)
{
  currentAge_f <- floor(currentAge) #negative time to secular death issue
  
  if(gender == 1 || gender == 'F' || gender == 'Female' || gender == 'f' || gender == 'female')
  {
    shape <- gompertz.parameters$female_shape[currentAge_f+1]
    rate  <- gompertz.parameters$female_rate[currentAge_f+1]
  }
  else
  {
    shape <- gompertz.parameters$male_shape[currentAge_f+1]
    rate  <- gompertz.parameters$male_rate[currentAge_f+1]
  }
  
  min(currentAge + rgompertz(1, shape, rate), 110)
}
